# Alpha Zero - ãƒ¯ã‚¿ãƒ«ãƒ¼ãƒˆå®Ÿè£…

Alpha Zeroæ–¹å¼ã®å¼·åŒ–å­¦ç¿’ã§ãƒ¯ã‚¿ãƒ«ãƒ¼ãƒˆã®å¼·ã„AIã‚’ä½œæˆã—ã¾ã™ã€‚

## ğŸ“‹ æ¦‚è¦

ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã¯ã€[alpha-zero-general](https://github.com/suragnair/alpha-zero-general)ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ã£ãŸãƒ¯ã‚¿ãƒ«ãƒ¼ãƒˆAIã®å®Ÿè£…ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

### ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

- **WataruToGame.py**: alpha-zero-generaläº’æ›ã®ã‚²ãƒ¼ãƒ ãƒ©ãƒƒãƒ‘ãƒ¼
- **pytorch/WataruToNNet.py**: ResNeté¢¨ã®ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯
- **pytorch/NNet.py**: å­¦ç¿’ãƒ»æ¨è«–ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
- **main.py**: å­¦ç¿’ãƒ¡ã‚¤ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
- **check_gpu.py**: GPUç’°å¢ƒç¢ºèªã‚¹ã‚¯ãƒªãƒ—ãƒˆ

## ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### 1. ç’°å¢ƒæº–å‚™

```bash
# PyTorch + CUDA ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu121

# ãã®ä»–ã®ä¾å­˜é–¢ä¿‚
pip install -r ../requirements.txt
```

### 2. GPUç¢ºèª

```bash
cd backend/alpha_zero
python check_gpu.py
```

æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›ï¼š
```
âœ… CUDAãŒåˆ©ç”¨å¯èƒ½ã§ã™ï¼
   GPUå: NVIDIA GeForce GTX 1650
   GPUç·ãƒ¡ãƒ¢ãƒª: 4.00 GB
âœ… ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆæˆåŠŸï¼Alpha Zeroå­¦ç¿’ã®æº–å‚™å®Œäº†ï¼
```

### 3. å­¦ç¿’é–‹å§‹

```bash
python main.py
```

å­¦ç¿’ãƒ•ã‚§ãƒ¼ã‚ºã‚’é¸æŠï¼š
1. **ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—**ï¼ˆ3ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã€ç´„30åˆ†-1æ™‚é–“ï¼‰- å‹•ä½œç¢ºèªç”¨
2. **çŸ­æœŸå­¦ç¿’**ï¼ˆ20ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã€ç´„3-4æ™‚é–“ï¼‰- æ€§èƒ½è©•ä¾¡ç”¨
3. **æœ¬æ ¼å­¦ç¿’**ï¼ˆ100ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã€ç´„1-2æ—¥ï¼‰- å¼·ã„AIä½œæˆ

## ğŸ¯ å­¦ç¿’ãƒ•ã‚§ãƒ¼ã‚ºã®è©³ç´°

### ãƒ•ã‚§ãƒ¼ã‚º1: ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ï¼ˆæ¨å¥¨ï¼šæœ€åˆã¯ã“ã¡ã‚‰ï¼‰

```python
è¨­å®š:
  - ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ•°: 3
  - å„ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®å¯¾æˆ¦æ•°: 5
  - MCTSã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³: 25å›
  - ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆ: 64ãƒãƒ£ãƒ³ãƒãƒ«ã€4æ®‹å·®ãƒ–ãƒ­ãƒƒã‚¯
  
æ¨å®šæ™‚é–“ï¼ˆGTX 1650ï¼‰:
  - 1ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³: ç´„10-20åˆ†
  - å…¨ä½“: 30åˆ†-1æ™‚é–“
  
ç›®çš„: å‹•ä½œç¢ºèªã€å•é¡Œã®æ—©æœŸç™ºè¦‹
```

### ãƒ•ã‚§ãƒ¼ã‚º2: çŸ­æœŸå­¦ç¿’

```python
è¨­å®š:
  - ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ•°: 20
  - å„ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®å¯¾æˆ¦æ•°: 15
  - MCTSã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³: 75å›
  - ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆ: 96ãƒãƒ£ãƒ³ãƒãƒ«ã€6æ®‹å·®ãƒ–ãƒ­ãƒƒã‚¯
  
æ¨å®šæ™‚é–“ï¼ˆGTX 1650ï¼‰:
  - 1ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³: ç´„10åˆ†
  - å…¨ä½“: ç´„3-4æ™‚é–“ï¼ˆå®Ÿæ¸¬å€¤ï¼‰
  
ç›®çš„: æ€§èƒ½è©•ä¾¡ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´
```

### ãƒ•ã‚§ãƒ¼ã‚º3: æœ¬æ ¼å­¦ç¿’

```python
è¨­å®š:
  - ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ•°: 100
  - å„ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®å¯¾æˆ¦æ•°: 25
  - MCTSã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³: 100å›
  - ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆ: 128ãƒãƒ£ãƒ³ãƒãƒ«ã€8æ®‹å·®ãƒ–ãƒ­ãƒƒã‚¯
  
æ¨å®šæ™‚é–“ï¼ˆGTX 1650ï¼‰:
  - 1ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³: ç´„10-15åˆ†
  - å…¨ä½“: ç´„1-2æ—¥
  
ç›®çš„: å¼·ã„AIã®ä½œæˆ
```

## ğŸ§  ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ç©ºé–“ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°

```
ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ID = (æ–¹å‘ Ã— 2 + ã‚µã‚¤ã‚º) Ã— (9Ã—9) + ä½ç½®

æ–¹å‘: 0=ç¸¦ã€1=æ¨ª
ã‚µã‚¤ã‚º: 0=4ãƒã‚¹ã€1=5ãƒã‚¹
ä½ç½®: è¡ŒÃ—9 + åˆ—

ä¾‹:
  (0,0)ã«ç¸¦4ãƒã‚¹: 0
  (0,0)ã«ç¸¦5ãƒã‚¹: 81
  (0,0)ã«æ¨ª4ãƒã‚¹: 162
  (0,0)ã«æ¨ª5ãƒã‚¹: 243
  (8,8)ã«æ¨ª5ãƒã‚¹: 323
```

### ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ§‹é€ 

```
å…¥åŠ› (6, 9, 9)
  â”œâ”€ ãƒãƒ£ãƒ³ãƒãƒ«0-3: ç›¤é¢ï¼ˆP1å±¤1,2 + P-1å±¤1,2ï¼‰
  â””â”€ ãƒãƒ£ãƒ³ãƒãƒ«4-5: æ®‹ã‚Šãƒ–ãƒ­ãƒƒã‚¯æƒ…å ±
    â†“
Conv2D(6â†’128, 3Ã—3) + BN + ReLU
    â†“
ResBlock(128) Ã— 8
    â”œâ”€ Conv2D(3Ã—3) + BN + ReLU
    â”œâ”€ Conv2D(3Ã—3) + BN
    â””â”€ Skip Connection + ReLU
    â†“
  â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
  â†“            â†“
Policy Head   Value Head
  â†“            â†“
Conv2D(1Ã—1)   Conv2D(1Ã—1)
  â†“            â†“
FC(324)       FC(128)â†’FC(1)
  â†“            â†“
Softmax       Tanh
  â†“            â†“
Ï€ (324)      v (-1~1)
```

### å­¦ç¿’ã‚µã‚¤ã‚¯ãƒ«ï¼ˆAlpha Zeroï¼‰

```
ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ 1...100:
  â”‚
  â”œâ”€ 1. è‡ªå·±å¯¾æˆ¦ï¼ˆ25ã‚²ãƒ¼ãƒ ï¼‰
  â”‚   â””â”€ ç¾åœ¨ã®ãƒ¢ãƒ‡ãƒ«ã§ã‚²ãƒ¼ãƒ ã‚’ãƒ—ãƒ¬ã‚¤
  â”‚   â””â”€ å„æ‰‹ã§MCTSï¼ˆ100ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
  â”‚   â””â”€ ãƒ‡ãƒ¼ã‚¿è¨˜éŒ²: (ç›¤é¢, æ–¹ç­–, å‹æ•—)
  â”‚
  â”œâ”€ 2. å­¦ç¿’ï¼ˆ10ã‚¨ãƒãƒƒã‚¯ï¼‰
  â”‚   â””â”€ è‡ªå·±å¯¾æˆ¦ãƒ‡ãƒ¼ã‚¿ã§ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆè¨“ç·´
  â”‚   â””â”€ ãƒãƒƒãƒã‚µã‚¤ã‚º64
  â”‚   â””â”€ æœ€é©åŒ–: Adam(lr=0.001)
  â”‚
  â”œâ”€ 3. è©•ä¾¡ï¼ˆ20ã‚²ãƒ¼ãƒ ï¼‰
  â”‚   â””â”€ æ–°ãƒ¢ãƒ‡ãƒ« vs æ—§ãƒ¢ãƒ‡ãƒ«
  â”‚
  â””â”€ 4. æ›´æ–°
      â””â”€ å‹ç‡ > 55% ãªã‚‰æ–°ãƒ¢ãƒ‡ãƒ«æ¡ç”¨
      â””â”€ ãƒ™ã‚¹ãƒˆãƒ¢ãƒ‡ãƒ«ã‚’ä¿å­˜
   
â†» ç¹°ã‚Šè¿”ã—
```

## ğŸ“Š ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡

### GTX 1650 (4GB VRAM)

| è¨­å®š | ãƒ¢ãƒ‡ãƒ«ã‚µã‚¤ã‚º | ãƒãƒƒãƒä½¿ç”¨é‡ | åˆè¨ˆ | çŠ¶æ…‹ |
|------|------------|------------|------|------|
| ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ— (64ch, 4blocks) | ~50MB | ~200MB | ~250MB | âœ… å®‰å…¨ |
| çŸ­æœŸå­¦ç¿’ (96ch, 6blocks) | ~100MB | ~400MB | ~500MB | âœ… å®‰å…¨ |
| æœ¬æ ¼å­¦ç¿’ (128ch, 8blocks) | ~150MB | ~600MB | ~750MB | âœ… æ¨å¥¨ |

**ãƒ¡ãƒ¢ãƒªä¸è¶³ã®å ´åˆ:**
- `batch_size`ã‚’32ã«å‰Šæ¸›
- `num_channels`ã‚’æ¸›ã‚‰ã™ï¼ˆ128â†’96ï¼‰
- `num_res_blocks`ã‚’æ¸›ã‚‰ã™ï¼ˆ8â†’6ï¼‰

## ğŸ® å­¦ç¿’æ¸ˆã¿ãƒ¢ãƒ‡ãƒ«ã®ä½¿ç”¨

### APIçµ±åˆï¼ˆäºˆå®šï¼‰

```python
# backend/api/main.py ã«è¿½åŠ 
from alpha_zero.pytorch.NNet import NNetWrapper
from alpha_zero.WataruToGame import WataruToGame

# ãƒ¢ãƒ‡ãƒ«èª­ã¿è¾¼ã¿
game_wrapper = WataruToGame(board_size=9)
nnet = NNetWrapper(game_wrapper)
nnet.load_checkpoint('./alpha_zero/models/', 'best.pth.tar')

@app.post("/api/ai-move-alphazero")
async def get_alphazero_move(request: AIMovesRequest):
    # ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã‚’å–å¾—
    game = games[request.game_id]
    
    # Alpha Zeroäºˆæ¸¬
    canonical_board = game_wrapper.getCanonicalForm(game, game.current_player)
    pi, v = nnet.predict(canonical_board)
    
    # åˆæ³•æ‰‹ã®ãƒã‚¹ã‚¯
    valid_moves = game_wrapper.getValidMoves(game, game.current_player)
    pi = pi * valid_moves
    pi = pi / np.sum(pi)
    
    # æœ€å–„æ‰‹ã‚’é¸æŠ
    best_action = np.argmax(pi)
    best_move = game_wrapper._action_to_move(best_action, game)
    
    return {"move": best_move.to_dict()}
```

## ğŸ“ˆ é€²æ—ç¢ºèª

å­¦ç¿’ä¸­ã¯ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã¾ã™ï¼š

```
models/
â”œâ”€â”€ best.pth.tar          # ãƒ™ã‚¹ãƒˆãƒ¢ãƒ‡ãƒ«
â”œâ”€â”€ checkpoint_X.pth.tar  # å„ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ
â””â”€â”€ checkpoint_X.examples # å­¦ç¿’ãƒ‡ãƒ¼ã‚¿
```

## ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### CUDA Out of Memory

```python
# main.py ã§ batch_size ã‚’å‰Šæ¸›
'batch_size': 32,  # 64 â†’ 32
```

### å­¦ç¿’ãŒé…ã„

```python
# MCTSã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å›æ•°ã‚’å‰Šæ¸›
'numMCTSSims': 50,  # 100 â†’ 50
```

### ãƒ¢ãƒ‡ãƒ«ãŒå¼·ããªã‚‰ãªã„

- ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ•°ã‚’å¢—ã‚„ã™ï¼ˆ100 â†’ 200ï¼‰
- MCTSã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å›æ•°ã‚’å¢—ã‚„ã™ï¼ˆ100 â†’ 200ï¼‰
- ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆã‚’å¤§ããã™ã‚‹ï¼ˆãƒãƒ£ãƒ³ãƒãƒ«æ•°ã€æ®‹å·®ãƒ–ãƒ­ãƒƒã‚¯æ•°ï¼‰

## ğŸ”§ ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãƒã‚¤ãƒ³ãƒˆ

### ã‚ˆã‚Šå¼·ã„AIã‚’ä½œã‚‹

```python
# main.py ã‚’ç·¨é›†
'numIters': 200,          # ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ•°ã‚’å¢—ã‚„ã™
'numMCTSSims': 200,       # MCTSæ¢ç´¢ã‚’æ·±ãã™ã‚‹
'num_channels': 256,      # ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’å¤§ããã™ã‚‹
'num_res_blocks': 20,     # ã‚ˆã‚Šæ·±ã„ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯
```

### ã‚ˆã‚Šé€Ÿãå­¦ç¿’ã™ã‚‹

```python
'numEps': 10,             # å¯¾æˆ¦æ•°ã‚’æ¸›ã‚‰ã™
'numMCTSSims': 50,        # MCTSæ¢ç´¢ã‚’æµ…ãã™ã‚‹
'num_channels': 64,       # ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’å°ã•ãã™ã‚‹
'num_res_blocks': 4,
```

### ãƒ¡ãƒ¢ãƒªã‚’ç¯€ç´„ã™ã‚‹

```python
'batch_size': 32,         # ãƒãƒƒãƒã‚µã‚¤ã‚ºã‚’æ¸›ã‚‰ã™
'maxlenOfQueue': 5000,    # ãƒãƒƒãƒ•ã‚¡ã‚µã‚¤ã‚ºã‚’æ¸›ã‚‰ã™
```

## ğŸ“š å‚è€ƒæ–‡çŒ®

1. **AlphaGo Zeroè«–æ–‡**
   - Silver, D. et al. (2017). "Mastering the game of Go without human knowledge"
   - https://www.nature.com/articles/nature24270

2. **Alpha Zeroè«–æ–‡**
   - Silver, D. et al. (2017). "Mastering Chess and Shogi by Self-Play with a General Reinforcement Learning Algorithm"
   - https://arxiv.org/abs/1712.01815

3. **alpha-zero-generalå®Ÿè£…**
   - https://github.com/suragnair/alpha-zero-general

## ğŸ“ˆ æœŸå¾…ã•ã‚Œã‚‹çµæœ

### ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ï¼ˆ3ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¾Œï¼‰
- ãƒ©ãƒ³ãƒ€ãƒ ã‚ˆã‚Šã¯å¼·ã„
- æ˜ã‚‰ã‹ãªãƒŸã‚¹ã¯æ¸›ã‚‹
- åŸºæœ¬çš„ãªæˆ¦ç•¥ã‚’å­¦ç¿’

### çŸ­æœŸå­¦ç¿’ï¼ˆ20ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¾Œï¼‰
- æˆ¦è¡“çš„ãªæ‰‹ã‚’æ‰“ã¤
- é˜²å¾¡ã‚‚è€ƒæ…®
- Pure MCTSã¨åŒç­‰ç¨‹åº¦

### æœ¬æ ¼å­¦ç¿’ï¼ˆ100ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¾Œï¼‰
- Tactical MCTSã‚ˆã‚Šå¼·ã„
- é•·æœŸçš„ãªæˆ¦ç•¥ã‚’ç†è§£
- ä¸€è²«æ€§ã®ã‚ã‚‹å¼·ã•

## ğŸ’¡ ä»Šå¾Œã®æ”¹å–„æ¡ˆ

- [ ] å¯¾ç§°æ€§ã‚’åˆ©ç”¨ã—ãŸãƒ‡ãƒ¼ã‚¿æ‹¡å¼µï¼ˆ8å€ã®ãƒ‡ãƒ¼ã‚¿ï¼‰
- [ ] ã‚ˆã‚Šæ·±ã„ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼ˆResBlock 10-20å±¤ï¼‰
- [ ] ã‚ˆã‚Šå¤§ããªç›¤é¢ï¼ˆ18Ã—18ï¼‰ã¸ã®æ‹¡å¼µ
- [ ] æ··åˆç²¾åº¦å­¦ç¿’ï¼ˆãƒ¡ãƒ¢ãƒªå‰Šæ¸›ï¼‰
- [ ] åˆ†æ•£å­¦ç¿’ï¼ˆè¤‡æ•°GPUï¼‰
- [ ] ã‚ˆã‚Šé«˜åº¦ãªMCTSï¼ˆPUCTæ”¹è‰¯ï¼‰

---

**ä½œæˆæ—¥**: 2024å¹´11æœˆ
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0
**ãƒ©ã‚¤ã‚»ãƒ³ã‚¹**: MIT

